zabbix_export:
  version: '7.0'
  template_groups:
    - uuid: 7df96b18c230490a9a0a9e2307226338
      name: Templates
  templates:
    - uuid: 1d94437d4e37499bb2c5abf47fde6c00
      template: 'Home Assistant - Zabbix Agent Active'
      name: 'Home Assistant - Zabbix Agent Active'
      description: |
        Home Assistant-Template, erstellt von Thomas Rzen.
        
        To ensure this template operates correctly, the URL and the API key should be stored in the Macros section.
      groups:
        - name: Templates
      items:
        - uuid: 2c4ed5c0c5be4840ac89801834efae58
          name: HA-raw
          type: HTTP_AGENT
          key: ha.raw
          value_type: TEXT
          trends: '0'
          url: '{$HA.URL}/api/states'
          headers:
            - name: Authorization
              value: 'Bearer {$API.KEY}'
          output_format: JSON
      discovery_rules:
        - uuid: d6a30debaed74aa09515805c866d8b87
          name: HA-Automation
          type: DEPENDENT
          key: ha.automation
          delay: '0'
          filter:
            conditions:
              - macro: '{#ENTITY_ID}'
                value: '^automation\..*'
                formulaid: A
          item_prototypes:
            - uuid: 7e37c15d52c346ed8aaf351a882e36a9
              name: 'automation {#ENTITY_ID}'
              type: DEPENDENT
              key: 'ha.autot[{#ENTITY_ID}]'
              delay: '0'
              trends: '0'
              description: |
                enabled = 1
                disabled = 0
                unavailable = 2
              preprocessing:
                - type: JSONPATH
                  parameters:
                    - '$.body[?(@.entity_id == "{#ENTITY_ID}")].state'
                - type: LTRIM
                  parameters:
                    - '["'
                - type: RTRIM
                  parameters:
                    - '"]'
                - type: STR_REPLACE
                  parameters:
                    - 'on'
                    - '1'
                - type: STR_REPLACE
                  parameters:
                    - 'off'
                    - '0'
                - type: STR_REPLACE
                  parameters:
                    - unavailable
                    - '2'
              master_item:
                key: ha.raw
              tags:
                - tag: 'Home Assistant'
                  value: automations
          master_item:
            key: ha.raw
          lld_macro_paths:
            - lld_macro: '{#ENTITY_ID}'
              path: $.entity_id
          preprocessing:
            - type: JSONPATH
              parameters:
                - '$.body[*]'
        - uuid: 041bbefc72cb4ffea38a2012e0b79cf2
          name: HA-Batterie
          type: DEPENDENT
          key: ha.batt
          delay: '0'
          filter:
            conditions:
              - macro: '{#ENTITY_ID}'
                value: '.*_battery$'
                formulaid: A
          item_prototypes:
            - uuid: 175a65ef0f384596a0bc5177ea1b0458
              name: 'Battery level of {#ENTITY_ID}'
              type: DEPENDENT
              key: 'ent.bat[{#ENTITY_ID}]'
              delay: '0'
              value_type: FLOAT
              units: '!%'
              preprocessing:
                - type: JSONPATH
                  parameters:
                    - '$.body[?(@.entity_id == "{#ENTITY_ID}")].state'
                - type: LTRIM
                  parameters:
                    - '["'
                - type: RTRIM
                  parameters:
                    - '"]'
              master_item:
                key: ha.raw
              tags:
                - tag: 'Home Assistant'
                  value: battery-level
              trigger_prototypes:
                - uuid: daaafb9fae15422e9df4375d90a3fb36
                  expression: 'last(/Home Assistant - Zabbix Agent Active/ent.bat[{#ENTITY_ID}])<20'
                  name: 'Battery replacement at {#ENTITY_ID} is required.'
                  priority: DISASTER
          master_item:
            key: ha.raw
          lld_macro_paths:
            - lld_macro: '{#ENTITY_ID}'
              path: $.entity_id
          preprocessing:
            - type: JSONPATH
              parameters:
                - '$.body[*]'
        - uuid: b21d364cbc23433ca3876572fb74b8bb
          name: HA-Camera
          type: DEPENDENT
          key: ha.camera
          delay: '0'
          filter:
            conditions:
              - macro: '{#ENTITY_ID}'
                value: '^camera\..*'
                formulaid: A
          item_prototypes:
            - uuid: a69e97081d10499ba67335c3cbd2a1e4
              name: 'Camera status {#ENTITY_ID}'
              type: DEPENDENT
              key: 'ha.cam.stat[{#ENTITY_ID}]'
              delay: '0'
              value_type: TEXT
              trends: '0'
              description: |
                unavailable = 0
                available = 1
                idle = 2
              preprocessing:
                - type: JSONPATH
                  parameters:
                    - '$.body[?(@.entity_id == "{#ENTITY_ID}")].state'
                - type: LTRIM
                  parameters:
                    - '["'
                - type: RTRIM
                  parameters:
                    - '"]'
                - type: STR_REPLACE
                  parameters:
                    - unavailable
                    - '0'
                - type: STR_REPLACE
                  parameters:
                    - available
                    - '1'
                - type: STR_REPLACE
                  parameters:
                    - idle
                    - '2'
              master_item:
                key: ha.raw
              tags:
                - tag: 'Home Assistant'
                  value: camera
          master_item:
            key: ha.raw
          lld_macro_paths:
            - lld_macro: '{#ENTITY_ID}'
              path: $.entity_id
          preprocessing:
            - type: JSONPATH
              parameters:
                - '$.body[*]'
        - uuid: 1311148760784d948dc433324f030bc9
          name: HA-Contact-Sensor
          type: DEPENDENT
          key: ha.contact
          delay: '0'
          filter:
            conditions:
              - macro: '{#ENTITY_ID}'
                value: '.*_contact$'
                formulaid: A
          item_prototypes:
            - uuid: c7d6d4e1266d4310ac88aec260d7e490
              name: 'Open/Close Sensor {#ENTITY_ID}'
              type: DEPENDENT
              key: 'ent.conbtact[{#ENTITY_ID}]'
              delay: '0'
              trends: '0'
              description: |
                Closed = 0
                Open = 1
              preprocessing:
                - type: JSONPATH
                  parameters:
                    - '$.body[?(@.entity_id == "{#ENTITY_ID}")].state'
                - type: LTRIM
                  parameters:
                    - '["'
                - type: RTRIM
                  parameters:
                    - '"]'
                - type: STR_REPLACE
                  parameters:
                    - 'off'
                    - '0'
                - type: STR_REPLACE
                  parameters:
                    - 'on'
                    - '1'
              master_item:
                key: ha.raw
              tags:
                - tag: 'Home Assistant'
                  value: contact-sensor-status
          master_item:
            key: ha.raw
          lld_macro_paths:
            - lld_macro: '{#ENTITY_ID}'
              path: $.entity_id
          preprocessing:
            - type: JSONPATH
              parameters:
                - '$.body[*]'
        - uuid: 1f4986b135ca49d3a47930d0e43c7eac
          name: HA-Weather-forecast
          type: DEPENDENT
          key: ha.forecast
          delay: '0'
          filter:
            conditions:
              - macro: '{#ENTITY_ID}'
                value: '.*forecast_home$'
                formulaid: A
          item_prototypes:
            - uuid: df0e32186224466481e2ebe7f8e9bab4
              name: 'Weather forecast {#ENTITY_ID}'
              type: DEPENDENT
              key: 'ha.forecast[{#ENTITY_ID}]'
              delay: '0'
              description: |
                1. clear-night
                   Clear night sky without clouds.
                
                2. cloudy
                   Cloudy, many clouds in the sky.
                
                3. fog
                   Foggy, reduced visibility.
                
                4. hail
                   Hail.
                
                5. lightning
                   Thunderstorm with lightning and thunder.
                
                6. partlycloudy
                   Partly cloudy, both clear and covered sections.
                
                7. pouring
                   Heavy rain, intense precipitation.
                
                8. raining
                   Rain.
                
                9. rainy
                   Rainy, can vary in intensity.
                
                10. sleet
                    Sleet or graupel.
                
                11. snowing
                    Snowfall.
                
                12. snowy
                    Snowy, can include varying intensities of snowfall.
                
                13. stormy
                    Stormy weather, strong winds and possible precipitation.
                
                14. windy
                    Windy, strong or persistent winds.
                
                15. exception
                    A non-standard state or an error.
              preprocessing:
                - type: JSONPATH
                  parameters:
                    - '$.body[?(@.entity_id == "{#ENTITY_ID}")].state'
                - type: LTRIM
                  parameters:
                    - '["'
                - type: RTRIM
                  parameters:
                    - '"]'
                - type: STR_REPLACE
                  parameters:
                    - clear-night
                    - '1'
                - type: STR_REPLACE
                  parameters:
                    - cloudy
                    - '2'
                - type: STR_REPLACE
                  parameters:
                    - fog
                    - '3'
                - type: STR_REPLACE
                  parameters:
                    - hail
                    - '4'
                - type: STR_REPLACE
                  parameters:
                    - lightning
                    - '5'
                - type: STR_REPLACE
                  parameters:
                    - partlycloudy
                    - '6'
                - type: STR_REPLACE
                  parameters:
                    - pouring
                    - '7'
                - type: STR_REPLACE
                  parameters:
                    - raining
                    - '8'
                - type: STR_REPLACE
                  parameters:
                    - rainy
                    - '9'
                - type: STR_REPLACE
                  parameters:
                    - sleet
                    - '10'
                - type: STR_REPLACE
                  parameters:
                    - snowing
                    - '11'
                - type: STR_REPLACE
                  parameters:
                    - snowy
                    - '12'
                - type: STR_REPLACE
                  parameters:
                    - stormy
                    - '13'
                - type: STR_REPLACE
                  parameters:
                    - windy
                    - '14'
                - type: STR_REPLACE
                  parameters:
                    - exception
                    - '15'
              master_item:
                key: ha.raw
              tags:
                - tag: 'Home Assistant'
                  value: weather-forecast
          master_item:
            key: ha.raw
          lld_macro_paths:
            - lld_macro: '{#ENTITY_ID}'
              path: $.entity_id
          preprocessing:
            - type: JSONPATH
              parameters:
                - '$.body[*]'
        - uuid: 2459164c5d1d4a0ca13f527612377f35
          name: HA-Zigbee-linkquality
          type: DEPENDENT
          key: ha.linkquality
          delay: '0'
          filter:
            conditions:
              - macro: '{#ENTITY_ID}'
                value: '.*_linkquality$'
                formulaid: A
          item_prototypes:
            - uuid: adb345f9bd2942a2a2ca378028c15eb5
              name: 'ZigBee-Linkquality {#ENTITY_ID}'
              type: DEPENDENT
              key: 'ent.linkquality[{#ENTITY_ID}]'
              delay: '0'
              value_type: FLOAT
              units: '!LQI'
              preprocessing:
                - type: JSONPATH
                  parameters:
                    - '$.body[?(@.entity_id == "{#ENTITY_ID}")].state'
                - type: LTRIM
                  parameters:
                    - '["'
                - type: RTRIM
                  parameters:
                    - '"]'
              master_item:
                key: ha.raw
              tags:
                - tag: 'Home Assistant'
                  value: zigbee-linkquality
              trigger_prototypes:
                - uuid: bcd8ff30b0ec4ac2806732d3a9209c06
                  expression: 'last(/Home Assistant - Zabbix Agent Active/ent.linkquality[{#ENTITY_ID}])<{$ZIGBEE.SIGNAL.MINIMUM}'
                  name: 'The ZigBee connection of {#ENTITY_ID}: {ITEM.LASTVALUE}'
                  priority: HIGH
          master_item:
            key: ha.raw
          lld_macro_paths:
            - lld_macro: '{#ENTITY_ID}'
              path: $.entity_id
          preprocessing:
            - type: JSONPATH
              parameters:
                - '$.body[*]'
        - uuid: 9b9c150e83af417599542bd13274a9f6
          name: HA-Humidity
          type: DEPENDENT
          key: ha.luft
          delay: '0'
          filter:
            conditions:
              - macro: '{#ENTITY_ID}'
                value: '.*_humidity$'
                formulaid: A
          item_prototypes:
            - uuid: d5b546cae3cb4664b5b2675002ad5111
              name: 'Humidity of {#ENTITY_ID}'
              type: DEPENDENT
              key: 'ent.luft[{#ENTITY_ID}]'
              delay: '0'
              value_type: FLOAT
              units: '!%'
              preprocessing:
                - type: JSONPATH
                  parameters:
                    - '$.body[?(@.entity_id == "{#ENTITY_ID}")].state'
                - type: LTRIM
                  parameters:
                    - '["'
                - type: RTRIM
                  parameters:
                    - '"]'
              master_item:
                key: ha.raw
              tags:
                - tag: 'Home Assistant'
                  value: humidity
          master_item:
            key: ha.raw
          lld_macro_paths:
            - lld_macro: '{#ENTITY_ID}'
              path: $.entity_id
          preprocessing:
            - type: JSONPATH
              parameters:
                - '$.body[*]'
        - uuid: 53a32b87ee124a02a6893561d31b23da
          name: HA-Temperature
          type: DEPENDENT
          key: ha.temp
          delay: '0'
          filter:
            conditions:
              - macro: '{#ENTITY_ID}'
                value: '.*temperature$'
                formulaid: A
          item_prototypes:
            - uuid: 3cb17f2dc8394b51b57ace27f0547c26
              name: 'Temperatur {#ENTITY_ID}'
              type: DEPENDENT
              key: 'ent.i.d[{#ENTITY_ID}]'
              delay: '0'
              value_type: FLOAT
              trends: '0'
              units: '!°C'
              preprocessing:
                - type: JSONPATH
                  parameters:
                    - '$.body[?(@.entity_id == "{#ENTITY_ID}")].state'
                - type: RTRIM
                  parameters:
                    - '"]'
                - type: LTRIM
                  parameters:
                    - '["'
              master_item:
                key: ha.raw
              tags:
                - tag: 'Home Assistant'
                  value: 'degrees celsius'
          master_item:
            key: ha.raw
          lld_macro_paths:
            - lld_macro: '{#ENTITY_ID}'
              path: $.entity_id
          preprocessing:
            - type: JSONPATH
              parameters:
                - '$.body[*]'
        - uuid: 8922c14e83f04a738cddab0e484dfd49
          name: HA-Update
          type: DEPENDENT
          key: ha.update
          delay: '0'
          filter:
            conditions:
              - macro: '{#ENTITY_ID}'
                value: '.*_update$'
                formulaid: A
          item_prototypes:
            - uuid: f721473c84cd46eeb204fa5e2c304e8b
              name: 'Update available for {#ENTITY_ID}.'
              type: DEPENDENT
              key: 'ha.update[{#ENTITY_ID}]'
              delay: '0'
              description: |
                0 = Kein Update verfügbar
                1 = Ein Update ist verfügbar
              preprocessing:
                - type: JSONPATH
                  parameters:
                    - '$.body[?(@.entity_id == "{#ENTITY_ID}")].state'
                - type: LTRIM
                  parameters:
                    - '["'
                - type: RTRIM
                  parameters:
                    - '"]'
                - type: STR_REPLACE
                  parameters:
                    - 'on'
                    - '1'
                - type: STR_REPLACE
                  parameters:
                    - 'off'
                    - '0'
              master_item:
                key: ha.raw
              tags:
                - tag: 'Home Assistant'
                  value: update
              trigger_prototypes:
                - uuid: 9bd597210e2a4b4b9e35ada4ab0b36fa
                  expression: 'last(/Home Assistant - Zabbix Agent Active/ha.update[{#ENTITY_ID}])=1'
                  name: 'Home Assistant update for {#ENTITY_ID} is available.'
                  priority: HIGH
                  manual_close: 'YES'
          master_item:
            key: ha.raw
          lld_macro_paths:
            - lld_macro: '{#ENTITY_ID}'
              path: $.entity_id
          preprocessing:
            - type: JSONPATH
              parameters:
                - '$.body[*]'
        - uuid: 72328c6a1ac745ffbd3e11758cfac97d
          name: HA-Firmware-Update
          type: DEPENDENT
          key: ha.update.firmware
          delay: '0'
          filter:
            conditions:
              - macro: '{#ENTITY_ID}'
                value: '.*_firmware$'
                formulaid: A
          item_prototypes:
            - uuid: c03379cfab1046a5bbaea1bef589a383
              name: 'Firmware-update {#ENTITY_ID}'
              type: DEPENDENT
              key: 'ent.firmware[{#ENTITY_ID}]'
              delay: '0'
              trends: '0'
              description: |
                0 = No update available
                1 = An update is available
                2 = Firmware version unavailable
              preprocessing:
                - type: JSONPATH
                  parameters:
                    - '$.body[?(@.entity_id == "{#ENTITY_ID}")].state'
                - type: LTRIM
                  parameters:
                    - '["'
                - type: RTRIM
                  parameters:
                    - '"]'
                - type: STR_REPLACE
                  parameters:
                    - 'off'
                    - '0'
                - type: STR_REPLACE
                  parameters:
                    - 'on'
                    - '1'
                - type: STR_REPLACE
                  parameters:
                    - unavailable
                    - '2'
              master_item:
                key: ha.raw
              tags:
                - tag: 'Home Assistant'
                  value: firmware-update
              trigger_prototypes:
                - uuid: 2cec62c566f04555b8ccac1a128d1a1a
                  expression: 'last(/Home Assistant - Zabbix Agent Active/ent.firmware[{#ENTITY_ID}])=1'
                  name: 'Firmware update for {#ENTITY_ID} is available.'
                  priority: WARNING
                - uuid: b84255b67cc1466e8deff251c49d2f17
                  expression: 'last(/Home Assistant - Zabbix Agent Active/ent.firmware[{#ENTITY_ID}])=2'
                  name: 'Firmware version for {#ENTITY_ID} is not available'
                  priority: WARNING
          master_item:
            key: ha.raw
          lld_macro_paths:
            - lld_macro: '{#ENTITY_ID}'
              path: $.entity_id
          preprocessing:
            - type: JSONPATH
              parameters:
                - '$.body[*]'
        - uuid: b20727113c364d5ba4a098b050fd5663
          name: HA-Watt
          type: DEPENDENT
          key: ha.watt
          delay: '0'
          filter:
            conditions:
              - macro: '{#ENTITY_ID}'
                value: '.*_power$'
                formulaid: A
          item_prototypes:
            - uuid: ccd1924ee7e6456fab25344d2245430c
              name: 'Watt {#ENTITY_ID}'
              type: DEPENDENT
              key: 'ent.watt[{#ENTITY_ID}]'
              delay: '0'
              value_type: FLOAT
              trends: '0'
              units: '!Watt'
              preprocessing:
                - type: JSONPATH
                  parameters:
                    - '$.body[?(@.entity_id == "{#ENTITY_ID}")].state'
                - type: LTRIM
                  parameters:
                    - '["'
                - type: RTRIM
                  parameters:
                    - '"]'
                - type: STR_REPLACE
                  parameters:
                    - unavailable
                    - '0'
              master_item:
                key: ha.raw
              tags:
                - tag: 'Home Assistant'
                  value: Watt
          master_item:
            key: ha.raw
          lld_macro_paths:
            - lld_macro: '{#ENTITY_ID}'
              path: $.entity_id
          preprocessing:
            - type: JSONPATH
              parameters:
                - '$.body[*]'
      macros:
        - macro: '{$API.KEY}'
          type: SECRET_TEXT
        - macro: '{$HA.URL}'
          value: 'http://192.168.10.121:8123'
        - macro: '{$ZIGBEE.SIGNAL.MINIMUM}'
          value: '90'
